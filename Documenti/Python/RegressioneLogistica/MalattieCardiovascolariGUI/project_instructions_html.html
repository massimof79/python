<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Istruzioni Progetto Rischio Cardiovascolare</title>
    <style>
        @media print {
            body { margin: 0; }
            .no-print { display: none; }
        }
        
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px;
            background: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        h2 {
            color: #3498db;
            margin-top: 30px;
        }
        
        h3 {
            color: #555;
            margin-top: 20px;
        }
        
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        
        pre {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        
        pre code {
            background: transparent;
            color: #ecf0f1;
        }
        
        .warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
        }
        
        .info {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 20px 0;
        }
        
        .success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 20px 0;
        }
        
        .btn {
            background: #3498db;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 20px 0;
        }
        
        .btn:hover {
            background: #2980b9;
        }
        
        ul, ol {
            margin: 15px 0;
            padding-left: 30px;
        }
        
        li {
            margin: 8px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        
        th {
            background: #3498db;
            color: white;
        }
        
        .footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container" id="content">
        <h1>ðŸ«€ Sistema di Predizione del Rischio Cardiovascolare</h1>
        <p><strong>Guida Completa all'Installazione e all'Avvio</strong></p>
        <p>Versione 1.0 - Basato su Regressione Logistica</p>

        <h2>ðŸ“‹ Indice</h2>
        <ol>
            <li>Requisiti di Sistema</li>
            <li>Installazione delle Dipendenze</li>
            <li>Struttura del Progetto</li>
            <li>Configurazione e Avvio del Backend</li>
            <li>Configurazione e Avvio del Frontend</li>
            <li>Test del Sistema</li>
            <li>Risoluzione Problemi Comuni</li>
        </ol>

        <h2>1. Requisiti di Sistema</h2>
        
        <h3>Software Necessario:</h3>
        <ul>
            <li><strong>Python 3.7 o superiore</strong> - Linguaggio di programmazione per il backend</li>
            <li><strong>pip</strong> - Gestore pacchetti Python (solitamente incluso con Python)</li>
            <li><strong>Browser Web moderno</strong> - Chrome, Firefox, Safari o Edge</li>
            <li><strong>Editor di testo</strong> - VS Code, Sublime Text, o qualsiasi editor</li>
        </ul>

        <h3>Verifica Installazione Python:</h3>
        <pre><code>python --version
# o
python3 --version</code></pre>

        <div class="info">
            <strong>ðŸ’¡ Nota:</strong> Se Python non Ã¨ installato, scaricalo da <a href="https://www.python.org/downloads/" target="_blank">python.org</a>
        </div>

        <h2>2. Installazione delle Dipendenze</h2>

        <h3>Apri il terminale/prompt dei comandi e installa:</h3>
        <pre><code>pip install flask flask-cors pandas scikit-learn</code></pre>

        <div class="success">
            <strong>âœ… Pacchetti installati:</strong>
            <ul>
                <li><strong>flask</strong> - Framework web per il server API</li>
                <li><strong>flask-cors</strong> - Gestione Cross-Origin Resource Sharing</li>
                <li><strong>pandas</strong> - Manipolazione e analisi dati</li>
                <li><strong>scikit-learn</strong> - Libreria di Machine Learning</li>
            </ul>
        </div>

        <h2>3. Struttura del Progetto</h2>

        <p>Crea una cartella per il progetto e organizza i file come segue:</p>

        <pre><code>cardiovascular-prediction/
â”‚
â”œâ”€â”€ app.py                 # Server Flask (Backend)
â”œâ”€â”€ index.html            # Interfaccia web (Frontend)
â””â”€â”€ README.md             # Documentazione (opzionale)</code></pre>

        <h2>4. Configurazione e Avvio del Backend</h2>

        <h3>Passo 1: Crea il file app.py</h3>
        <p>Crea un nuovo file chiamato <code>app.py</code> e copia il seguente codice:</p>

        <pre><code>"""
API Flask per Predizione Rischio Cardiovascolare
"""

from flask import Flask, request, jsonify
from flask_cors import CORS
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LogisticRegression

app = Flask(__name__)
CORS(app)

print("Caricamento del modello...")

url = "https://archive.ics.uci.edu/ml/machine-learning-databases/heart-disease/processed.cleveland.data"

colonne = [
    'age', 'sex', 'cp', 'trestbps', 'chol', 'fbs',
    'restecg', 'thalach', 'exang', 'oldpeak',
    'slope', 'ca', 'thal', 'target'
]

df = pd.read_csv(url, names=colonne, na_values='?')
df = df.dropna()
df['target'] = (df['target'] > 0).astype(int)

X = df.drop('target', axis=1)
y = df['target']

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42, stratify=y
)

scaler = StandardScaler()
X_train = scaler.fit_transform(X_train)
X_test = scaler.transform(X_test)

model = LogisticRegression(max_iter=1000)
model.fit(X_train, y_train)

print("Modello addestrato e pronto!")

@app.route('/predict', methods=['POST'])
def predict():
    try:
        data = request.json
        
        paziente = pd.DataFrame([{
            'age': data['age'],
            'sex': data['sex'],
            'cp': data['cp'],
            'trestbps': data['trestbps'],
            'chol': data['chol'],
            'fbs': data['fbs'],
            'restecg': data['restecg'],
            'thalach': data['thalach'],
            'exang': data['exang'],
            'oldpeak': data['oldpeak'],
            'slope': data['slope'],
            'ca': data['ca'],
            'thal': data['thal']
        }])
        
        paziente_scaled = scaler.transform(paziente)
        
        predizione = model.predict(paziente_scaled)[0]
        probabilita = model.predict_proba(paziente_scaled)[0][1]
        
        return jsonify({
            'prediction': int(predizione),
            'probability': float(probabilita),
            'risk': 'high' if predizione == 1 else 'low',
            'message': 'A RISCHIO' if predizione == 1 else 'SANO'
        })
    
    except Exception as e:
        return jsonify({'error': str(e)}), 400

@app.route('/health', methods=['GET'])
def health():
    return jsonify({'status': 'ok', 'model': 'Logistic Regression'})

if __name__ == '__main__':
    app.run(debug=True, port=5000)</code></pre>

        <h3>Passo 2: Avvia il server</h3>
        <p>Nel terminale, dalla cartella del progetto, esegui:</p>
        <pre><code>python app.py</code></pre>

        <div class="success">
            <strong>âœ… Output atteso:</strong>
            <pre><code>Caricamento del modello...
Modello addestrato e pronto!
 * Running on http://127.0.0.1:5000
 * Restarting with stat
 * Debugger is active!</code></pre>
        </div>

        <h2>5. Configurazione e Avvio del Frontend</h2>

        <h3>Passo 1: Crea il file index.html</h3>
        <p>Il codice HTML completo Ã¨ giÃ  stato fornito nell'artifact precedente. Salvalo come <code>index.html</code> nella stessa cartella.</p>

        <h3>Passo 2: Apri il file HTML</h3>
        <ul>
            <li>Fai doppio clic su <code>index.html</code></li>
            <li>Oppure aprilo con il browser (File â†’ Apri File)</li>
        </ul>

        <h2>6. Test del Sistema</h2>

        <h3>Test Rapido con Dati Precompilati</h3>
        <ol>
            <li>Il form Ã¨ giÃ  precompilato con i dati di un paziente di esempio</li>
            <li>Clicca direttamente su <strong>"Calcola Rischio"</strong></li>
            <li>Dovresti vedere il risultato della predizione con la probabilitÃ </li>
        </ol>

        <h3>Parametri del Paziente di Esempio</h3>
        <table>
            <tr>
                <th>Parametro</th>
                <th>Valore</th>
                <th>Descrizione</th>
            </tr>
            <tr>
                <td>EtÃ </td>
                <td>60</td>
                <td>Anni</td>
            </tr>
            <tr>
                <td>Sesso</td>
                <td>Maschile</td>
                <td>1 = M, 0 = F</td>
            </tr>
            <tr>
                <td>Tipo Dolore Toracico</td>
                <td>Angina Tipica</td>
                <td>0-3</td>
            </tr>
            <tr>
                <td>Pressione Riposo</td>
                <td>150</td>
                <td>mm Hg</td>
            </tr>
            <tr>
                <td>Colesterolo</td>
                <td>250</td>
                <td>mg/dl</td>
            </tr>
            <tr>
                <td>Glicemia Digiuno</td>
                <td>SÃ¬ (>120)</td>
                <td>1 = SÃ¬, 0 = No</td>
            </tr>
            <tr>
                <td>FC Massima</td>
                <td>130</td>
                <td>battiti/min</td>
            </tr>
            <tr>
                <td>Oldpeak</td>
                <td>2.3</td>
                <td>Depressione ST</td>
            </tr>
        </table>

        <h2>7. Risoluzione Problemi Comuni</h2>

        <h3>Problema 1: "Errore: Assicurati che il server Python sia in esecuzione"</h3>
        <div class="warning">
            <strong>Soluzione:</strong>
            <ul>
                <li>Verifica che il server Flask sia avviato (controlla il terminale)</li>
                <li>Assicurati che sia in esecuzione su <code>http://localhost:5000</code></li>
                <li>Se usi una porta diversa, modifica <code>API_URL</code> nell'HTML</li>
            </ul>
        </div>

        <h3>Problema 2: "ModuleNotFoundError: No module named 'flask'"</h3>
        <div class="warning">
            <strong>Soluzione:</strong>
            <pre><code>pip install flask flask-cors pandas scikit-learn</code></pre>
        </div>

        <h3>Problema 3: Errore CORS nel browser</h3>
        <div class="warning">
            <strong>Soluzione:</strong>
            <ul>
                <li>Verifica che <code>flask-cors</code> sia installato</li>
                <li>Controlla che <code>CORS(app)</code> sia presente in app.py</li>
            </ul>
        </div>

        <h3>Problema 4: Il server non si avvia sulla porta 5000</h3>
        <div class="warning">
            <strong>Soluzione:</strong>
            <p>La porta 5000 potrebbe essere occupata. Modifica la porta in app.py:</p>
            <pre><code>app.run(debug=True, port=5001)  # Usa 5001 invece di 5000</code></pre>
            <p>E aggiorna l'URL nell'HTML:</p>
            <pre><code>const API_URL = 'http://localhost:5001/predict';</code></pre>
        </div>

        <h2>ðŸ“Š Informazioni sul Modello</h2>

        <div class="info">
            <h3>Algoritmo Utilizzato</h3>
            <p><strong>Regressione Logistica</strong> - Un algoritmo di classificazione binaria che stima la probabilitÃ  che un paziente sia a rischio di malattia cardiovascolare.</p>
            
            <h3>Dataset</h3>
            <p>UCI Machine Learning Repository - Cleveland Heart Disease Database</p>
            <p>297 pazienti dopo la pulizia dei dati mancanti</p>
            
            <h3>Preprocessing</h3>
            <ul>
                <li>Standardizzazione delle feature (media=0, std=1)</li>
                <li>Rimozione valori mancanti</li>
                <li>Split 80/20 train/test stratificato</li>
            </ul>
        </div>

        <h2>ðŸŽ¯ Utilizzo del Sistema</h2>

        <ol>
            <li>Inserisci i dati clinici del paziente nel form</li>
            <li>Clicca su "Calcola Rischio"</li>
            <li>Il sistema mostrerÃ :
                <ul>
                    <li>Classificazione: A RISCHIO o SANO</li>
                    <li>ProbabilitÃ  in percentuale</li>
                    <li>Raccomandazioni cliniche</li>
                </ul>
            </li>
        </ol>

        <div class="footer">
            <p><strong>Sistema di Predizione del Rischio Cardiovascolare</strong></p>
            <p>Basato su Machine Learning con Regressione Logistica</p>
            <p>Per supporto tecnico o domande, consultare la documentazione di scikit-learn e Flask</p>
        </div>
    </div>

    <div class="no-print" style="text-align: center; margin-top: 30px;">
        <button class="btn" onclick="window.print()">ðŸ“„ Scarica PDF (Stampa)</button>
        <p style="color: #666; margin-top: 10px;">Usa la funzione di stampa del browser e seleziona "Salva come PDF"</p>
    </div>

    <script>
        // Aggiungi la data corrente
        window.onload = function() {
            const today = new Date().toLocaleDateString('it-IT', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.querySelector('.container p:nth-of-type(2)').innerHTML += ` - Generato il ${today}`;
        };
    </script>
</body>
</html>